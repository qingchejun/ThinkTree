# 🧠 ThinkSo - AI 驱动的思维导图生成工具

将文档内容转换为专业思维导图，基于 Google Gemini AI 和 Markmap 可视化技术。

**当前版本**: v3.2.2-stable 🎉 用户中心 + 管理员后台 + 企业级安全完整

## 🌐 在线体验

- **🖥️ 前端应用**: https://thinkso.io
- **👤 邀请制注册**: https://thinkso.io/register (需邀请码)
- **🔐 用户登录**: https://thinkso.io/login
- **👤 用户中心**: https://thinkso.io/settings (个人资料/密码/邀请码)
- **🔑 忘记密码**: https://thinkso.io/forgot-password
- **🔧 API 服务**: https://thinktree-backend.onrender.com
- **📚 API 文档**: https://thinktree-backend.onrender.com/docs
- **💚 健康检查**: https://thinktree-backend.onrender.com/health

## ✨ 功能特性

- 🤖 **AI 智能解析**: 基于 Google Gemini API 智能提取文档关键信息
- 📁 **多格式上传**: 支持 PDF、DOCX、TXT、MD、SRT 等多种文档格式
- 🎯 **拖拽上传**: 现代化的文件上传体验，支持拖拽和点击选择
- 🗺️ **Markmap 渲染**: 使用 markmap-lib 和 markmap-view 生成专业思维导图
- 📱 **响应式设计**: 完美适配桌面和移动设备
- 🔄 **自适应布局**: 思维导图自动适应窗口大小，支持缩放和拖拽
- ⚡ **实时生成**: 输入文本即时生成思维导图
- 🎨 **现代 UI**: 基于 Tailwind CSS 的美观界面
- ☁️ **云端部署**: Render 平台稳定运行，随时随地访问
- 🎫 **邀请制注册**: 邀请码验证 + 邮箱激活双重保障，高质量用户 (v3.2.0 ✅)
- 📧 **邮件验证系统**: Gmail SMTP + HTML 模板，自动发送验证和重置邮件 (v3.2.0 ✅)
- 🔑 **密码重置**: 15 分钟安全令牌 + 邮件重置 + 防枚举攻击保护 (v3.2.0 ✅)
- 👤 **完整认证体系**: 注册/登录/密码重置，JWT 令牌认证保护 (v3.2.0 ✅)
- 🛡️ **权限保护**: 思维导图创建需登录，API 认证中间件保护 (v3.2.0 ✅)
- 💾 **数据持久化**: PostgreSQL 云端数据库，用户数据安全存储 (v2.0.0 ✅)
- 🔒 **安全加密**: bcrypt 密码加密，JWT 安全令牌管理 (v2.0.0 ✅)
- 🌐 **全局状态**: React Context 用户状态管理，跨页面状态同步 (v2.1.0 ✅)
- 💾 **思维导图保存**: 一键保存生成的思维导图到个人账户 (v2.2.0 ✅)
- 🔄 **自动登录**: 注册成功后无缝自动登录体验 (v2.2.0 ✅)
- 🗄️ **数据不丢失**: PostgreSQL + Alembic 迁移，重新部署数据永久保存 (v2.2.0 ✅)
- 🔗 **分享功能**: 一键生成分享链接，支持公开访问和权限控制 (v3.0.0 ✅)
- 📥 **导出功能**: 支持 SVG/PNG 格式高清导出和文件下载 (v3.0.0 ✅)
- 📖 **展开折叠**: 智能节点控制，一键切换详细/概览视图模式 (v3.1.0 ✅)
- 👤 **用户中心**: 个人资料管理/密码修改/邀请码管理/统一设置界面 (v3.2.2 ✅)
- 👨‍💼 **管理员后台**: 统计仪表盘/用户管理/邀请码管理/操作日志 (v3.2.2 ✅)
- 🛡️ **企业级安全**: 速率限制/强密码验证/reCAPTCHA/权限控制 (v3.2.2 ✅)

## 🛠️ 技术栈

**前端**

- Next.js 14 (App Router)
- React 18
- Tailwind CSS 3
- markmap-view + markmap-lib + 展开折叠交互
- D3.js
- React Context (用户状态管理)
- Canvas API (PNG 导出)
- React Hot Toast (通知系统)

**后端**

- FastAPI (Python 3.11)
- PostgreSQL (云端数据库)
- SQLAlchemy ORM + Alembic (数据库迁移)
- JWT + bcrypt (认证加密)
- fastapi-mail + Gmail SMTP (邮件系统)
- slowapi (速率限制)
- Google Gemini AI API
- PyMuPDF + pdfplumber + python-docx
- 邀请码系统 + 用户中心 + 管理员后台
- 异步文件处理

**部署**

- Render Cloud Platform (Singapore)
- PostgreSQL 数据库服务
- 前后端分离部署
- 环境变量配置管理

## 🎉 v3.2.2 重大更新

### 🏢 企业级用户管理系统 (全新功能)

ThinkSo v3.2.2 构建了完整的企业级用户管理和安全防护体系：

**✅ 用户中心功能**

- **个人资料管理**: 👤 显示名称修改 + 用户信息查看
- **密码安全管理**: 🔒 当前密码验证 + 新密码强度检查
- **邀请码管理**: 🎫 生成邀请码 + 使用统计 + 剩余配额显示
- **统一设置界面**: ⚙️ 侧边栏导航 + 模块化页面设计

**✅ 管理员后台系统**

- **统计仪表盘**: 📊 用户统计 + 思维导图统计 + 今日新增数据
- **用户管理功能**: 👥 列表查看 + 搜索筛选 + 状态操作 + 批量管理
- **邀请码管理**: 🎫 批量生成 + 使用监控 + 权限控制
- **操作日志系统**: 📝 管理员操作记录 + 安全审计 + 完整追踪

**✅ 企业级安全防护**

- **速率限制保护**: 🚫 10 次/分钟登录限制，防止暴力破解
- **强密码验证**: 🔐 前后端密码复杂度检查 + 实时强度提示
- **reCAPTCHA 集成**: 🤖 人机验证防护，防止自动化攻击
- **权限控制完善**: 🛡️ 超级用户权限 + 功能级权限验证

**🏗️ 技术架构完善**

- **数据库模型扩展**: User.is_verified + InvitationCode 表 + 完整关联
- **API 接口完整**: 认证 + 用户中心 + 管理后台 + 统计分析
- **前端界面完善**: 注册验证 + 用户设置 + 管理员后台界面
- **安全机制加强**: JWT + bcrypt + 速率限制 + 输入验证

## 🎉 v3.1.0 历史更新

### 📖 展开折叠交互功能 (全新功能)

ThinkSo v3.1.0 新增智能展开折叠功能，让用户可以灵活控制思维导图的详细程度：

**✅ 智能交互**

- **一键切换**: 📖 展开按钮显示完整结构，📄 折叠按钮显示概览视图
- **智能折叠**: 自动保留根节点和一级分支，隐藏深层细节信息
- **视图优化**: 概览模式便于把握整体结构，详细模式便于深入研究
- **无缝集成**: 与现有 markmap 渲染系统完美融合，性能优化

### 💾 数据持久化功能 (v2.2.0 基础功能)

ThinkSo 实现了完整的数据持久化系统，用户可以保存和管理自己的思维导图：

**✅ 核心功能**

- **思维导图保存**: 一键保存生成的思维导图到个人账户
- **数据持久化**: PostgreSQL + Alembic 迁移，重新部署数据不丢失
- **全局状态管理**: React Context 实现跨页面用户状态同步
- **自动登录**: 注册成功后无缝自动登录，优化用户体验

**🗄️ 数据库架构**

- **Mindmap 模型**: UUID 主键，用户关联，支持标题/描述/标签
- **CRUD API**: 完整的增删改查接口，JWT 认证保护
- **数据安全**: 用户只能访问自己的思维导图数据
- **迁移工具**: Alembic 数据库版本管理，支持结构变更

**🌐 用户体验升级**

- **状态显示**: 首页和思维导图页面统一显示登录状态
- **保存流程**: 登录用户可直接保存，未登录用户显示登录提示
- **自动跳转**: 登录成功后跳转到首页，注册后自动登录
- **数据安全**: 所有用户数据永久保存，不会因重新部署丢失

**🚀 立即体验**

1. 获取邀请码后访问 [注册页面](https://thinkso.io/register) 创建账户
2. 检查邮箱完成邮箱验证激活账户
3. 登录后生成思维导图，点击"💾 保存"按钮
4. 享受完整认证保护的个人化思维导图体验

## 🏗️ 项目架构

### 系统架构

```
用户注册 → 邮箱验证 → 账户激活 → 安全登录
     ↓
文档上传/文本输入 → AI智能处理 → 思维导图生成 → 分享与导出
     ↓
完善的用户管理体系 + 企业级安全防护 + 云端数据存储
```

### 数据流

```
用户输入/文件上传 → FastAPI后端 → 文件解析器 → Gemini AI处理 →
Markdown结构数据 → markmap-lib转换 → markmap-view渲染思维导图
```

### 目录结构

```
ThinkTree/
├── frontend/                 # Next.js 前端应用
│   ├── app/                 # App Router 页面
│   │   ├── page.jsx        # 主页
│   │   ├── login/          # 登录页面
│   │   ├── register/       # 注册页面
│   │   ├── settings/       # 用户中心 (个人资料/密码/邀请码)
│   │   ├── admin/          # 管理员后台 (统计/用户管理/邀请码)
│   │   ├── dashboard/      # 个人控制台
│   │   └── ...
│   ├── components/          # React 组件
│   │   ├── mindmap/        # 思维导图组件
│   │   ├── upload/         # 文件上传组件
│   │   ├── admin/          # 管理员后台组件
│   │   └── common/         # 通用组件
│   └── lib/                # 工具库和 API 封装
├── backend/                 # FastAPI 后端应用
│   ├── app/
│   │   ├── api/            # API 路由
│   │   │   ├── auth.py     # 认证 + 用户中心
│   │   │   ├── admin.py    # 管理员后台
│   │   │   └── invitations.py # 邀请码管理
│   │   ├── core/           # 核心业务逻辑
│   │   ├── models/         # 数据模型 (User + InvitationCode)
│   │   └── utils/          # 工具函数 (安全/邮件)
│   ├── main.py             # 应用入口
│   └── requirements.txt    # Python 依赖
└── docs/                    # 项目文档
```

## 🚀 快速开始

### 在线使用 (推荐)

1. **访问应用**: https://thinkso.io
2. **选择模式**: 文件上传 或 直接输入文本
3. **上传文档**: 支持 PDF、DOCX、TXT、MD、SRT 格式
4. **生成思维导图**: AI 自动解析并生成专业思维导图
5. **交互探索**: 缩放、拖拽、平移思维导图

### 本地开发

#### 环境要求

- Node.js 18+
- Python 3.11+
- Google Gemini API Key

#### 克隆项目

```bash
git clone https://github.com/qingchejun/ThinkTree.git
cd ThinkTree
```

#### 后端启动

```bash
cd backend

# 创建虚拟环境
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate

# 安装依赖
pip install -r requirements.txt

# 配置环境变量
echo "GEMINI_API_KEY=your_api_key_here" > .env

# 启动服务 (端口 8000)
python main.py
```

#### 前端启动

```bash
cd frontend

# 安装依赖
npm install

# 配置环境变量 (可选，默认连接本地后端)
echo "NEXT_PUBLIC_API_URL=http://localhost:8000" > .env.local

# 启动开发服务器 (端口 3000)
npm run dev
```

#### 获取 Google Gemini API Key

1. 访问 [Google AI Studio](https://aistudio.google.com/app/apikey)
2. 登录 Google 账号
3. 创建新的 API Key
4. 复制 API Key 到环境变量

## 📖 使用指南

### 文件上传功能

1. **支持格式**: PDF、DOCX、TXT、MD、SRT
2. **文件大小**: 最大 10MB
3. **上传方式**: 拖拽上传 或 点击选择
4. **处理速度**: PDF 解析采用 PyMuPDF，速度提升 3-5 倍

### 文本输入功能

1. **直接输入**: 在文本框中输入任意内容
2. **格式支持**: 支持 Markdown 和纯文本
3. **长度限制**: 建议 4000 字符以内
4. **实时处理**: 点击生成即时处理

### AI 处理特性

- **无损信息**: 零信息损失，保留所有关键细节
- **结构识别**: 自动识别文档逻辑结构
- **智能提炼**: 将内容转换为结构化思维导图
- **中文优化**: 针对中文内容优化处理效果

## 🔥 v2.0.0 新功能

### ✅ 用户认证系统 (后端完成)

- **用户注册**: 安全的邮箱密码注册流程
- **用户登录**: JWT 令牌认证，7 天有效期
- **密码安全**: bcrypt 哈希加密，防止明文存储
- **数据验证**: 邮箱格式、密码强度验证
- **令牌管理**: 自动令牌生成、验证、解析

### ✅ 数据库架构

- **PostgreSQL**: 企业级云端数据库
- **SQLAlchemy ORM**: 类型安全的数据库操作
- **用户模型**: 完整的用户信息和状态管理
- **自动建表**: 应用启动时自动创建数据结构
- **数据持久化**: 用户数据永久安全存储

### 🔄 前端认证 (开发中)

- **认证页面**: `/login` 和 `/register` 页面设计
- **状态管理**: React Context 全局用户状态
- **令牌存储**: 安全的 JWT 令牌本地存储
- **路由保护**: 私有路由和认证中间件
- **用户界面**: 导航栏用户菜单和个人信息

### 🎯 v2.0.0 技术升级

- **认证架构**: JWT + bcrypt + PostgreSQL
- **API 接口**: RESTful 认证 API，完整的 Swagger 文档
- **安全特性**: SQL 注入防护，密码哈希，令牌验证
- **个人化**: 从匿名工具到个人化应用的转变

## 📊 v1.2.0 已完成功能

### ✅ 云端部署

- **Render 平台**: 稳定的云端运行环境
- **全球访问**: 新加坡节点，低延迟高性能
- **HTTPS 安全**: 全程加密传输
- **自动扩容**: 根据访问量自动调整资源

### ✅ 文档上传优化

- **多格式支持**: PDF、Word、文本、字幕文件
- **高性能解析**: PyMuPDF 库集成，处理速度显著提升
- **界面简化**: 移除复杂选项，专注核心功能
- **错误处理**: 完善的错误提示和重试机制

### ✅ AI 处理升级

- **知识架构师模板**: 专业级信息提取 prompt
- **结构保留**: 识别并保持原文逻辑层次
- **精确提炼**: 具体化呈现替代模糊概括
- **完整性检查**: 确保信息无遗漏

## 🔧 开发调试

### 端口冲突解决

如果遇到端口被占用问题：

```bash
# 查看端口占用
lsof -i :3000  # 前端端口
lsof -i :8000  # 后端端口

# 终止进程
kill -9 <PID>

# 或使用项目提供的一键启动脚本
./start_services.sh
```

### 诊断工具

```bash
# 检查服务状态
curl http://localhost:8000/health
curl http://localhost:3000

# 检查 API 连通性
curl -X POST http://localhost:8000/api/process-text \
  -H "Content-Type: application/json" \
  -d '{"text":"测试文本","format_type":"standard"}'
```

### 常见问题

1. **API 连接失败**: 检查后端服务是否启动，端口是否正确
2. **思维导图不显示**: 检查浏览器控制台错误，确认 markmap 资源加载
3. **文件上传失败**: 检查文件格式和大小，确认后端文件解析库安装

## 📊 项目状态

### 当前版本: v3.2.2-stable 🎉 企业级用户管理系统完整

- **状态**: 🎉 企业级用户管理系统和安全防护体系已完成
- **用户中心**: 个人资料管理 + 密码修改 + 邀请码管理 + 统一界面
- **管理后台**: 统计仪表盘 + 用户管理 + 邀请码管理 + 操作日志
- **安全防护**: 速率限制 + 强密码验证 + reCAPTCHA + 权限控制
- **部署**: 生产环境稳定运行，企业级安全保障

### v3.2.2 功能覆盖

- ✅ **用户中心基础**: 个人资料管理 + 密码修改 + 邀请码管理
- ✅ **管理员后台**: 统计仪表盘 + 用户管理 + 邀请码管理 + 操作日志
- ✅ **企业级安全**: 速率限制 + 强密码验证 + reCAPTCHA + 权限控制
- ✅ **邀请制认证**: 邀请码验证 + 邮箱验证 + 高质量用户准入
- ✅ **权限系统**: JWT 认证 + 超级用户权限 + 功能级保护
- ✅ **数据持久化**: PostgreSQL + Alembic 迁移 + 完整关联
- ✅ **思维导图**: AI 处理 + Markmap 渲染 + 展开折叠
- ✅ **分享导出**: 公开链接 + SVG/PNG 导出
- ✅ **云端服务**: Render 平台 + 自动化部署

### 技术特性

- **用户体系**: 完整的用户注册、登录、管理功能
- **安全防护**: 多层次安全保护机制
- **数据管理**: 可靠的云端数据存储与备份
- **系统架构**: 现代化的前后端分离架构

## 🔮 项目路线图

详细的发展规划和功能路线图请参考项目内部文档。我们持续改进产品功能，致力于为用户提供更好的思维导图生成体验。

如需了解最新功能更新和计划，请：
- 关注项目更新动态
- 提交功能建议和反馈

## 🤝 贡献指南

### 开发贡献

1. Fork 项目仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

### 问题反馈

- **Bug 报告**: 请提供详细的错误信息和复现步骤
- **功能建议**: 欢迎提出改进建议和新功能想法
- **文档改进**: 帮助完善项目文档和使用指南

## 📄 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件

## 🙏 致谢

- [Next.js](https://nextjs.org/) - React 全栈框架
- [FastAPI](https://fastapi.tiangolo.com/) - 现代 Python Web 框架
- [Markmap](https://markmap.js.org/) - 思维导图可视化库
- [Google Gemini](https://ai.google.dev/) - AI 内容生成服务
- [Render](https://render.com/) - 云端部署平台
- [Tailwind CSS](https://tailwindcss.com/) - 原子化 CSS 框架

---

**开发团队**: ThinkSo Team  
**最后更新**: 2025-07-26  
**项目状态**: 🎉 v3.2.2-stable 企业级用户管理系统 + 管理员后台 + 安全防护完整  
**在线地址**: https://thinkso.io  
**技术架构**: 用户中心 + 管理员后台 + 企业级安全 + 思维导图生成 + 分享导出

### 持续发展

我们将持续优化产品功能和用户体验，详细规划请参考项目内部文档。
